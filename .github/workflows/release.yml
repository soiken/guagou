name: Update Release with Latest File

on:
  push:
    branches:
      - main

jobs:
  update-release:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@LATEST

    - name: Download Latest File
      run: |
        wget -O latest_file.mpackage https://github.com/soiken/guagou/raw/main/build/Nekios.mpackage
      continue-on-error: true

    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          latest_file.mpackage
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Delete Previous Release
      run: |
        release_id=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" https://api.github.com/repos/${{ github.repository }}/releases/latest | jq -r '.id')
        if [ ! -z "$release_id" ]; then
          curl -X DELETE -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" https://api.github.com/repos/${{ github.repository }}/releases/$release_id
        fi

